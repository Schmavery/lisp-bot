(define test-results (ref (hashmap)))

(define test-run (lambda () (let (
      test (lambda (name fn io-lst)
        (do (update! test-results (lambda (v) (assoc v name (reduce
          (lambda (acc in out)
            (if (equal? (apply fn in) out)
              acc
              (cons (list in out (apply fn in)) acc)
          ))   nil (every-other-even io-lst) (every-other-odd io-lst))))
        ) nil)
     ))
  (do
    (test "car" car '(((1)) 1))
    (test "list" list '((1 2) (1 2)))
    (test "identity" identity '((1) 1 (nil) nil))
    (test "Should Fail" identity '((1) 2 (2) 1))
  )
)))

(test-run)

(define test-print (lambda ()
  (join (map (lambda (test)
    (join (list (car test) ": "
      (if (nil? (second test)) "Passed" (join (cons "Failed"
        (map (lambda (v) (join (list "\n  In:" (string (car v)) " Expected:" (string (second v)) " Received:" (string (nth v 2))) "")) (second test))) ""))
    ) "")
  ) ((get test-results))) "\n")
))
